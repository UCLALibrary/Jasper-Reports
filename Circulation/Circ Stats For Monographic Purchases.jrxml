<?xml version="1.0" encoding="UTF-8"?>
<!-- Created with Jaspersoft Studio version 6.4.0.final using JasperReports Library version 6.4.1  -->
<jasperReport xmlns="http://jasperreports.sourceforge.net/jasperreports" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://jasperreports.sourceforge.net/jasperreports http://jasperreports.sourceforge.net/xsd/jasperreport.xsd" name="Circ Stats For Monographic Purchases" pageWidth="2160" pageHeight="612" orientation="Landscape" columnWidth="2120" leftMargin="20" rightMargin="20" topMargin="20" bottomMargin="20" isIgnorePagination="true" uuid="eff9f80b-198c-4a9e-83a4-24915266c773">
	<property name="com.jaspersoft.studio.data.sql.tables" value=""/>
	<property name="com.jaspersoft.studio.data.defaultdataadapter" value="VoyagerDataAdapter.xml"/>
	<property name="com.jaspersoft.studio.unit." value="inch"/>
	<property name="com.jaspersoft.studio.unit.pageHeight" value="inch"/>
	<property name="com.jaspersoft.studio.unit.pageWidth" value="inch"/>
	<property name="com.jaspersoft.studio.unit.topMargin" value="inch"/>
	<property name="com.jaspersoft.studio.unit.bottomMargin" value="inch"/>
	<property name="com.jaspersoft.studio.unit.leftMargin" value="inch"/>
	<property name="com.jaspersoft.studio.unit.rightMargin" value="inch"/>
	<property name="com.jaspersoft.studio.unit.columnWidth" value="inch"/>
	<property name="com.jaspersoft.studio.unit.columnSpacing" value="inch"/>
	<property name="net.sf.jasperreports.export.xls.auto.fit.column" value="true"/>
	<property name="net.sf.jasperreports.export.xls.auto.fit.row" value="true"/>
	<property name="net.sf.jasperreports.export.xls.column.width.ratio" value="2F"/>
	<property name="ireport.jasperserver.url" value="https://jasper.library.ucla.edu:8443/jasperserver-pro/"/>
	<property name="ireport.jasperserver.user" value="drickard"/>
	<property name="ireport.jasperserver.report.resource" value="/public/UCLA/Circulation/Circ_Stats_For_Monographic_Purchases_files/main_jrxml"/>
	<property name="ireport.jasperserver.reportUnit" value="/public/UCLA/Circulation/Circ_Stats_For_Monographic_Purchases"/>
	<parameter name="select_vendor" class="java.util.Collection">
		<parameterDescription><![CDATA[Vendor filter]]></parameterDescription>
	</parameter>
	<parameter name="ledger_name_multi" class="java.util.Collection">
		<parameterDescription><![CDATA[Ledger filter]]></parameterDescription>
	</parameter>
	<parameter name="fiscal_year_multi" class="java.util.Collection">
		<parameterDescription><![CDATA[FY filter]]></parameterDescription>
	</parameter>
	<queryString language="SQL">
		<![CDATA[SELECT
	v.vendor_code,
	f.fiscal_period_name,
	f.ledger_name,
	f.fund_code,
	bm.mfhd_id,
	bm.bib_id,
	bt.bib_format as bib_level,
	bt.begin_pub_date as date1,
	bt.pub_place,
	bt.language,
	vger_support.get_bib_tags(bt.bib_id, '035') as f035,
	ucladb.GetBibTag(bt.bib_id, '050') as f050,
	vger_support.unifix(bt.title) as title,
	vger_support.get_bib_tags(bt.bib_id, '245') as f245,
	vger_support.unifix(ucladb.GetTag(bt.bib_id, 'B', '650', 1)) as f650_1,
	vger_support.unifix(ucladb.GetTag(bt.bib_id, 'B', '650', 2)) as f650_2,
	vger_support.get_bib_tags(bt.bib_id, '852b') as f852b,
	vger_support.get_bib_tags(bt.bib_id, '852h') as f852h,
	ib.item_barcode as barcode,
	it.reserve_charges as reserves,
	it.historical_charges as charges,
	it.historical_browses as browses,
	it.recalls_placed as recalls,
	it.holds_placed as holds,
	it.historical_bookings as bookings,
	it.short_loan_charges as short_loans,
	( 
		select coalesce(sum(reserve_charges), 0)
		from ucladb.reserve_item_history
		where item_id = it.item_id
	) as hist_reserves
FROM
	ucladb.invoice i
	inner join ucladb.vendor v on i.vendor_id = v.vendor_id
	inner join ucladb.invoice_line_item ili on i.invoice_id = ili.invoice_id
	inner join ucladb.invoice_line_item_funds ilif on ili.inv_line_item_id = ilif.inv_line_item_id
	inner join ucladb.ucla_fundledger_vw f on ilif.ledger_id = f.ledger_id and ilif.fund_id = f.fund_id
	inner join ucladb.line_item_copy_status lics on ilif.copy_id = lics.copy_id
	inner join ucladb.line_item li on ili.line_item_id = li.line_item_id -- slight shortcut but no data loss for 2004-2005 at least
	left outer join ucladb.bib_mfhd bm on lics.mfhd_id = bm.mfhd_id
	left outer join ucladb.bib_text bt on bm.bib_id = bt.bib_id
	left outer join ucladb.mfhd_master mm on bm.mfhd_id = mm.mfhd_id
	left outer join ucladb.mfhd_item mi on mm.mfhd_id = mi.mfhd_id
	left outer join ucladb.item it on mi.item_id = it.item_id
	left outer join ucladb.item_barcode ib on it.item_id = ib.item_id and ib.barcode_status = 1 -- Approved
WHERE
	substr(bt.bib_format, 2, 1) = 'm' -- bib level
	AND i.invoice_status = 1 --approved invoices
	AND $X{IN, v.vendor_id, select_vendor}
	AND $X{IN, f.ledger_id, ledger_name_multi}
	AND $X{IN, f.fiscal_period_id, fiscal_year_multi} 
ORDER BY 
	vendor_code, 
	bib_id, 
	mfhd_id]]>
	</queryString>
	<field name="VENDOR_CODE" class="java.lang.String"/>
	<field name="FISCAL_PERIOD_NAME" class="java.lang.String"/>
	<field name="LEDGER_NAME" class="java.lang.String"/>
	<field name="FUND_CODE" class="java.lang.String"/>
	<field name="MFHD_ID" class="java.math.BigDecimal"/>
	<field name="BIB_ID" class="java.math.BigDecimal"/>
	<field name="BIB_LEVEL" class="java.lang.String"/>
	<field name="DATE1" class="java.lang.String"/>
	<field name="PUB_PLACE" class="java.lang.String"/>
	<field name="LANGUAGE" class="java.lang.String"/>
	<field name="F035" class="java.lang.String"/>
	<field name="F050" class="java.lang.String"/>
	<field name="TITLE" class="java.lang.String"/>
	<field name="F245" class="java.lang.String"/>
	<field name="F650_1" class="java.lang.String"/>
	<field name="F650_2" class="java.lang.String"/>
	<field name="F852B" class="java.lang.String"/>
	<field name="F852H" class="java.lang.String"/>
	<field name="BARCODE" class="java.lang.String"/>
	<field name="RESERVES" class="java.math.BigDecimal"/>
	<field name="CHARGES" class="java.math.BigDecimal"/>
	<field name="BROWSES" class="java.math.BigDecimal"/>
	<field name="RECALLS" class="java.math.BigDecimal"/>
	<field name="HOLDS" class="java.math.BigDecimal"/>
	<field name="BOOKINGS" class="java.math.BigDecimal"/>
	<field name="SHORT_LOANS" class="java.math.BigDecimal"/>
	<field name="HIST_RESERVES" class="java.math.BigDecimal"/>
	<background>
		<band splitType="Stretch"/>
	</background>
	<title>
		<band height="30" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="2120" height="30" uuid="2cb8a431-b3c3-4ece-a3df-deb4cb0f39a2">
					<property name="com.jaspersoft.studio.unit.x" value="pixel"/>
					<property name="com.jaspersoft.studio.unit.y" value="pixel"/>
				</reportElement>
				<textElement textAlignment="Center" verticalAlignment="Middle">
					<font size="16" isBold="true"/>
				</textElement>
				<text><![CDATA[Circ Stats For Monographic Purchases]]></text>
			</staticText>
		</band>
	</title>
	<columnHeader>
		<band height="30" splitType="Stretch">
			<staticText>
				<reportElement x="0" y="0" width="92" height="30" uuid="b067fb46-3b9a-4c6b-90a5-62bc7fa8ef14"/>
				<text><![CDATA[VENDOR CODE]]></text>
			</staticText>
			<staticText>
				<reportElement x="92" y="0" width="78" height="30" uuid="d0da4e52-9aab-4dd8-a1b5-c13cb1f31c33"/>
				<text><![CDATA[FISCAL PERIOD]]></text>
			</staticText>
			<staticText>
				<reportElement x="170" y="0" width="78" height="30" uuid="f5c155fa-1ebe-4e22-8a12-0ed64be99b05"/>
				<text><![CDATA[LEDGER NAME]]></text>
			</staticText>
			<staticText>
				<reportElement x="248" y="0" width="78" height="30" uuid="35e3d6c9-77fc-4ee1-a1c4-830ba1691a56"/>
				<text><![CDATA[FUND CODE]]></text>
			</staticText>
			<staticText>
				<reportElement x="326" y="0" width="78" height="30" uuid="7517d687-03b2-4f69-9453-1b3ae8e0f084"/>
				<text><![CDATA[MFHD ID]]></text>
			</staticText>
			<staticText>
				<reportElement x="404" y="0" width="78" height="30" uuid="a1848288-aab4-4e8b-b9ac-a1889fc390ef"/>
				<text><![CDATA[BIB ID]]></text>
			</staticText>
			<staticText>
				<reportElement x="482" y="0" width="78" height="30" uuid="e2546797-4092-4ee3-8ced-ff6b8743b398"/>
				<text><![CDATA[BIB LEVEL]]></text>
			</staticText>
			<staticText>
				<reportElement x="560" y="0" width="78" height="30" uuid="25f228a9-1da7-4058-b80b-9d4fb6f4e9bc"/>
				<text><![CDATA[DATE1]]></text>
			</staticText>
			<staticText>
				<reportElement x="638" y="0" width="78" height="30" uuid="657219bd-ddc1-4a99-8ed0-2385bc4c9eb2"/>
				<text><![CDATA[PUB PLACE]]></text>
			</staticText>
			<staticText>
				<reportElement x="716" y="0" width="78" height="30" uuid="6ba9b113-6ea4-468f-b4e3-b55e3da8e95a"/>
				<text><![CDATA[LANGUAGE]]></text>
			</staticText>
			<staticText>
				<reportElement x="794" y="0" width="78" height="30" uuid="6122b3b9-70b6-42b8-a557-9fe8ec18f419"/>
				<text><![CDATA[F035]]></text>
			</staticText>
			<staticText>
				<reportElement x="872" y="0" width="78" height="30" uuid="e78a0f73-d5b0-47db-97ee-7f86ad65d397"/>
				<text><![CDATA[F050]]></text>
			</staticText>
			<staticText>
				<reportElement x="950" y="0" width="78" height="30" uuid="45ff06a9-1222-4a96-95e7-3b08db6df628"/>
				<text><![CDATA[F245]]></text>
			</staticText>
			<staticText>
				<reportElement x="1028" y="0" width="78" height="30" uuid="6590987f-1e69-48d6-8ac1-48880c4bbaf9"/>
				<text><![CDATA[F650_1]]></text>
			</staticText>
			<staticText>
				<reportElement x="1106" y="0" width="78" height="30" uuid="9d7adeb5-661c-43b1-b88b-a1ae51f9b7fb"/>
				<text><![CDATA[F650_2]]></text>
			</staticText>
			<staticText>
				<reportElement x="1184" y="0" width="78" height="30" uuid="bc13f27e-2641-435c-b7d8-546bde79f931"/>
				<text><![CDATA[F852B]]></text>
			</staticText>
			<staticText>
				<reportElement x="1262" y="0" width="78" height="30" uuid="f0faaaff-8add-4f52-b474-2706ecfe39f7"/>
				<text><![CDATA[F852H]]></text>
			</staticText>
			<staticText>
				<reportElement x="1340" y="0" width="78" height="30" uuid="749ea997-e357-4918-a4e3-8af81e185fe7"/>
				<text><![CDATA[BARCODE]]></text>
			</staticText>
			<staticText>
				<reportElement x="1418" y="0" width="78" height="30" uuid="84598c90-752a-461c-93ee-0453ebbe1924"/>
				<text><![CDATA[RESERVES]]></text>
			</staticText>
			<staticText>
				<reportElement x="1496" y="0" width="78" height="30" uuid="9ad8f2b7-b95d-4fe6-b9d8-480a0f47a6f3"/>
				<text><![CDATA[CHARGES]]></text>
			</staticText>
			<staticText>
				<reportElement x="1574" y="0" width="78" height="30" uuid="81666a59-140e-4566-8d84-70b2224ddd8c"/>
				<text><![CDATA[BROWSES]]></text>
			</staticText>
			<staticText>
				<reportElement x="1652" y="0" width="78" height="30" uuid="2f2d1d5e-b608-4375-baaa-d654533add75"/>
				<text><![CDATA[RECALLS]]></text>
			</staticText>
			<staticText>
				<reportElement x="1730" y="0" width="78" height="30" uuid="e4994812-4cc1-4fd9-8403-2ed7cff8ea42"/>
				<text><![CDATA[HOLDS]]></text>
			</staticText>
			<staticText>
				<reportElement x="1808" y="0" width="78" height="30" uuid="1d887904-cadb-4ae3-880c-2a43284c6beb"/>
				<text><![CDATA[BOOKINGS]]></text>
			</staticText>
			<staticText>
				<reportElement x="1886" y="0" width="78" height="30" uuid="04b1d14d-1fbe-419b-b3be-40841f68ce04"/>
				<text><![CDATA[SHORT LOANS]]></text>
			</staticText>
			<staticText>
				<reportElement x="1964" y="0" width="78" height="30" uuid="fb60fc41-6b68-4408-951e-5e73df8b7d31"/>
				<text><![CDATA[HIST RESERVES]]></text>
			</staticText>
		</band>
	</columnHeader>
	<detail>
		<band height="30" splitType="Stretch">
			<textField isBlankWhenNull="true">
				<reportElement x="0" y="0" width="92" height="30" uuid="b4c81a66-0209-45cc-81ea-57ffce8daecc"/>
				<textFieldExpression><![CDATA[$F{VENDOR_CODE}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="92" y="0" width="78" height="30" uuid="ddd8a1d4-0b82-4c71-a2b5-fc79659c5b28"/>
				<textFieldExpression><![CDATA[$F{FISCAL_PERIOD_NAME}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="170" y="0" width="78" height="30" uuid="f04bd17d-316a-4441-9eee-3e19b0c1af46"/>
				<textFieldExpression><![CDATA[$F{LEDGER_NAME}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="248" y="0" width="78" height="30" uuid="b4cd087a-f21d-4623-a123-9278bfb56f1a"/>
				<textFieldExpression><![CDATA[$F{FUND_CODE}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="326" y="0" width="78" height="30" uuid="d41f7c06-7d1a-49bd-bfee-409d76b2ca01"/>
				<textFieldExpression><![CDATA[$F{MFHD_ID}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="404" y="0" width="78" height="30" uuid="f5d55d7f-585a-4769-a3c9-896544e82739"/>
				<textFieldExpression><![CDATA[$F{BIB_ID}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="482" y="0" width="78" height="30" uuid="da14681f-9514-4c08-8b8f-07b826b45d9b"/>
				<textFieldExpression><![CDATA[$F{BIB_LEVEL}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="560" y="0" width="78" height="30" uuid="5bcbb059-7be2-4892-8552-3cba7401daec">
					<property name="com.jaspersoft.studio.unit.y" value="inch"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{DATE1}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="638" y="0" width="78" height="30" uuid="d1e4ec51-4b05-41bd-a0da-cfeb3adee5e3"/>
				<textFieldExpression><![CDATA[$F{PUB_PLACE}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="716" y="0" width="78" height="30" uuid="a7529b22-eb04-4161-948c-037b3a543e40"/>
				<textFieldExpression><![CDATA[$F{LANGUAGE}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="794" y="0" width="78" height="30" uuid="c8e2b8eb-3984-4444-954d-cf1f0ffbaaa2"/>
				<textFieldExpression><![CDATA[$F{F035}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="872" y="0" width="78" height="30" uuid="b97d2ab7-44ae-4410-90ba-bfc4f6258b97"/>
				<textFieldExpression><![CDATA[$F{F050}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="950" y="0" width="78" height="30" uuid="e6bfb268-5bce-463a-b6b4-45fbba0dc374"/>
				<textFieldExpression><![CDATA[$F{F245}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1028" y="0" width="78" height="30" uuid="5f952a9f-5abe-48f1-80e6-a0fe2cd94714"/>
				<textFieldExpression><![CDATA[$F{F650_1}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1106" y="0" width="78" height="30" uuid="2349db5d-9235-4ddf-879c-2c719213f69e"/>
				<textFieldExpression><![CDATA[$F{F650_2}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1184" y="0" width="78" height="30" uuid="42919767-9233-4e9f-aa4b-f0af78860fbc"/>
				<textFieldExpression><![CDATA[$F{F852B}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1262" y="0" width="78" height="30" uuid="7f470a32-99be-49f5-8cbd-c9573bb6e9ed"/>
				<textFieldExpression><![CDATA[$F{F852H}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1340" y="0" width="78" height="30" uuid="ab2c97f5-c0ab-4314-a343-d0913c719e2a"/>
				<textFieldExpression><![CDATA[$F{BARCODE}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1418" y="0" width="78" height="30" uuid="bc924fa1-5960-4ae6-9033-b24f39ae79cd"/>
				<textFieldExpression><![CDATA[$F{RESERVES}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1496" y="0" width="78" height="30" uuid="26613cf5-19e8-4f77-bd08-61d75e0aaa20"/>
				<textFieldExpression><![CDATA[$F{CHARGES}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1574" y="0" width="78" height="30" uuid="eee6a9ea-97ac-45ae-89b7-fa0617726298"/>
				<textFieldExpression><![CDATA[$F{BROWSES}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1652" y="0" width="78" height="30" uuid="ff1b3825-cc47-4ca6-8af7-6ae0c56b6a9c"/>
				<textFieldExpression><![CDATA[$F{RECALLS}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1730" y="0" width="78" height="30" uuid="831c30fa-fc74-4c68-984b-a201dd49b267"/>
				<textFieldExpression><![CDATA[$F{HOLDS}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1808" y="0" width="78" height="30" uuid="53c3487b-f43f-4dca-9a5a-124100505e7e"/>
				<textFieldExpression><![CDATA[$F{BOOKINGS}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1886" y="0" width="78" height="30" uuid="fcf4ff07-2bb0-4eed-a52e-dc36d6c1b356"/>
				<textFieldExpression><![CDATA[$F{SHORT_LOANS}]]></textFieldExpression>
			</textField>
			<textField isBlankWhenNull="true">
				<reportElement x="1964" y="0" width="78" height="30" uuid="7f3a73f2-0d55-49ec-885d-f389f63dfbed">
					<property name="com.jaspersoft.studio.unit.y" value="inch"/>
				</reportElement>
				<textFieldExpression><![CDATA[$F{HIST_RESERVES}]]></textFieldExpression>
			</textField>
		</band>
	</detail>
</jasperReport>
