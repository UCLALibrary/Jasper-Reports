--YR LOST SYSTEM APPLIED ITEMS
select distinct 
   l.location_display_name as perm_location
, iv.call_no
, bt.author
, vger_support.Unifix(bt.title) AS title
, bt.isbn
, bt.bib_id
, (SELECT REPLACE(normal_heading, 'UCOCLC', '')
      FROM bib_index WHERE bib_id = bt.bib_id AND index_code = '0350' AND normal_heading LIKE 'UCOCLC%' AND ROWNUM < 2
  ) AS oclc_number      
--, mm.normalized_call_no   
, bt.publisher 
, bt.pub_place
, bt.publisher_date
, bt.language
, iv.enumeration
--    bi.bib_id as record_number,
, iv.barcode
--, pb.patron_barcode
, pg.patron_group_name
, is_m.item_status_date as lost_date
from
    ucladb.item i
    inner join ucladb.bib_item bi ON i.item_id = bi.item_id
    inner join ucladb.bib_text bt ON bi.bib_id = bt.bib_id
    --INNER JOIN BIB_MFHD bmf ON bt.BIB_ID = bmf.BIB_ID
    --INNER JOIN MFHD_MASTER mm ON bmf.MFHD_ID = mm.MFHD_ID
    inner join ucladb.item_vw iv ON bi.item_id = iv.item_id
    inner join ucladb.location l on i.perm_location = l.location_id
    inner join ucladb.item_status is_m ON i.item_id = is_m.item_id
    inner join ucladb.circ_transactions ct on i.item_id = ct.item_id
    inner join ucladb.patron_barcode pb on ct.patron_id = pb.patron_id and ct.patron_group_id = pb.patron_group_id 
    inner join ucladb.patron_group pg on ct.patron_group_id = pg.patron_group_id
where
    (is_m.item_status = 14 or is_m.item_status = 12)
    and l.location_code = 'yr'
    AND is_m.item_status_date BETWEEN trunc($P{startDate}) and trunc($P{endDate})
  
    order by iv.call_no
